<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>üé® Minesweeper Web</title>
<style>
body {
  font-family: Arial;
  background: #222;
  color: #fff;
  text-align: center;
  margin: 0;
}

#controls {
  margin: 10px;
}

input {
  width: 50px;
  text-align: center;
}

#timer {
  font-size: 20px;
  margin: 10px;
}

#grid {
  display: grid;
  grid-template-columns: repeat(var(--size), 40px);
  grid-gap: 2px;
  justify-content: center;
  margin-top: 20px;
}

.cell {
  width: 40px;
  height: 40px;
  border: 2px solid #666;
  background: #aad4ff;
  font-size: 20px;
  line-height: 40px;
  text-align: center;
  cursor: pointer;
  user-select: none;
  transition: background 0.2s, transform 0.1s;
}

.cell:hover {
  transform: scale(1.05);
}

.cell.revealed {
  background: #e0f0ff;
  border: 2px inset #666;
  cursor: default;
}

.cell.flagged {
  background: #ffcc66;
}

/* Zahlfarben klassisch Minesweeper */
.cell.revealed[data-count="1"] { color: blue; }
.cell.revealed[data-count="2"] { color: green; }
.cell.revealed[data-count="3"] { color: red; }
.cell.revealed[data-count="4"] { color: darkblue; }
.cell.revealed[data-count="5"] { color: brown; }
.cell.revealed[data-count="6"] { color: cyan; }
.cell.revealed[data-count="7"] { color: black; }
.cell.revealed[data-count="8"] { color: gray; }
</style>
</head>
<body>

<h1>üé® Minesweeper Web</h1>

<div id="controls">
    Feldgr√∂√üe: <input id="size" type="number" value="12" min="5" max="20">
    Minen: <input id="mines" type="number" value="25" min="1">
    <button onclick="startGame()">üîÅ Neustart</button>
</div>

<div id="timer">‚è±Ô∏è Zeit: 0s</div>
<div id="grid"></div>

<!-- Audio -->
<audio id="clickSound" src="https://freesound.org/data/previews/320/320181_5260876-lq.mp3"></audio>
<audio id="flagSound" src="https://freesound.org/data/previews/178/178186_3248244-lq.mp3"></audio>
<audio id="boomSound" src="https://freesound.org/data/previews/341/341695_3248244-lq.mp3"></audio>
<audio id="winSound" src="https://freesound.org/data/previews/276/276016_5121236-lq.mp3"></audio>

<script>
let size, mineCount, grid=[], flagged=[], timer, time=0, firstClick=true;
const colors = ["blue","green","red","darkblue","brown","cyan","black","gray"];

const clickSound = document.getElementById("clickSound");
const flagSound = document.getElementById("flagSound");
const boomSound = document.getElementById("boomSound");
const winSound = document.getElementById("winSound");

function startGame() {
    size = parseInt(document.getElementById("size").value);
    mineCount = parseInt(document.getElementById("mines").value);
    grid = [];
    flagged = [];
    firstClick = true;
    time = 0;
    document.getElementById("timer").innerText = "‚è±Ô∏è Zeit: 0s";
    clearInterval(timer);
    timer = setInterval(() => {
        time++;
        document.getElementById("timer").innerText = `‚è±Ô∏è Zeit: ${time}s`;
    }, 1000);

    const gridDiv = document.getElementById("grid");
    gridDiv.innerHTML = "";
    gridDiv.style.setProperty('--size', size);

    for(let i=0; i<size; i++){
        let row = [];
        for(let j=0; j<size; j++){
            let cell = document.createElement("div");
            cell.classList.add("cell");
            cell.dataset.row = i;
            cell.dataset.col = j;
            cell.onclick = () => clickCell(i,j);
            cell.oncontextmenu = (e) => { e.preventDefault(); flagCell(i,j); };
            gridDiv.appendChild(cell);
            row.push({mine:false, cell:cell, revealed:false});
        }
        grid.push(row);
    }
}

function placeMines(safeRow, safeCol){
    let positions = [];
    for(let i=0; i<size; i++){
        for(let j=0; j<size; j++){
            if(Math.abs(i-safeRow)<=1 && Math.abs(j-safeCol)<=1) continue;
            positions.push([i,j]);
        }
    }
    positions.sort(() => Math.random() - 0.5);
    for(let i=0; i<mineCount; i++){
        let [r,c] = positions[i];
        grid[r][c].mine = true;
    }
}

function clickCell(r,c){
    const cellObj = grid[r][c];
    if(cellObj.revealed || flagged.includes(cellObj)) return;

    if(firstClick){
        firstClick = false;
        placeMines(r,c);
    }

    if(cellObj.mine){
        cellObj.cell.innerText = "üí£";
        cellObj.cell.style.backgroundColor = "red";
        revealAllMines();
        boomSound.play();
        alert(`üí• Game Over! Aufgedeckte Felder: ${countRevealed()}`);
        clearInterval(timer);
        return;
    }

    revealCell(r,c);
    clickSound.currentTime = 0;
    clickSound.play();
    checkWin();
}

function flagCell(r,c){
    const cellObj = grid[r][c];
    if(cellObj.revealed) return;
    if(flagged.includes(cellObj)){
        flagged.splice(flagged.indexOf(cellObj),1);
        cellObj.cell.classList.remove("flagged");
        cellObj.cell.innerText = "";
    } else {
        flagged.push(cellObj);
        cellObj.cell.classList.add("flagged");
        cellObj.cell.innerText = "üö©";
        flagSound.currentTime = 0;
        flagSound.play();
    }
}

function revealCell(r,c){
    const cellObj = grid[r][c];
    if(cellObj.revealed) return;
    cellObj.revealed = true;
    cellObj.cell.classList.add("revealed");

    let count = 0;
    for(let dr=-1; dr<=1; dr++){
        for(let dc=-1; dc<=1; dc++){
            if(dr===0 && dc===0) continue;
            let nr = r+dr, nc = c+dc;
            if(nr>=0 && nr<size && nc>=0 && nc<size){
                if(grid[nr][nc].mine) count++;
            }
        }
    }

    if(count>0){
        cellObj.cell.innerText = count;
        cellObj.cell.dataset.count = count;
    } else {
        for(let dr=-1; dr<=1; dr++){
            for(let dc=-1; dc<=1; dc++){
                let nr = r+dr, nc = c+dc;
                if(nr>=0 && nr<size && nc>=0 && nc<size && !grid[nr][nc].revealed){
                    setTimeout(()=>revealCell(nr,nc), 30);
                }
            }
        }
    }
}

function revealAllMines(){
    for(let r=0;r<size;r++){
        for(let c=0;c<size;c++){
            if(grid[r][c].mine && !grid[r][c].revealed){
                grid[r][c].cell.innerText = "üí£";
                grid[r][c].cell.style.backgroundColor = "red";
            }
        }
    }
}

function countRevealed(){
    let cnt = 0;
    for(let r=0;r<size;r++){
        for(let c=0;c<size;c++){
            if(grid[r][c].revealed) cnt++;
        }
    }
    return cnt;
}

function checkWin(){
    if(countRevealed() === size*size - mineCount){
        revealAllMines();
        winSound.play();
        alert(`üèÜ Gewonnen! Zeit: ${time}s`);
        clearInterval(timer);
    }
}

startGame();
</script>

</body>
</html>
